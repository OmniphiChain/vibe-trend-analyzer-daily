<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NLP Sentiment Dashboard - Live Demo</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #00d4ff;
        }
        .input-section {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 15px;
            border: none;
            border-radius: 8px;
            background: #0f3460;
            color: #fff;
            font-size: 16px;
            resize: vertical;
        }
        textarea::placeholder {
            color: #888;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: #00d4ff;
            color: #1a1a2e;
            font-weight: bold;
        }
        .btn-primary:hover {
            background: #00a8cc;
        }
        .btn-primary:disabled {
            background: #555;
            cursor: not-allowed;
        }
        .btn-secondary {
            background: #e94560;
            color: #fff;
        }
        .model-toggles {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        .model-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .model-toggle input {
            width: 18px;
            height: 18px;
        }
        .progress-section {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .progress-bar {
            height: 8px;
            background: #0f3460;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #e94560);
            width: 0%;
            transition: width 0.3s;
        }
        .status-text {
            color: #888;
            font-size: 14px;
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        .result-card {
            background: #16213e;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }
        .result-card.loading {
            opacity: 0.5;
        }
        .result-card.complete {
            border: 2px solid #00d4ff;
        }
        .result-card h3 {
            color: #00d4ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .result-card h3 .icon {
            font-size: 24px;
        }
        .sentiment-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 14px;
        }
        .sentiment-positive { background: #00c853; color: #fff; }
        .sentiment-negative { background: #ff1744; color: #fff; }
        .sentiment-neutral { background: #ffc107; color: #000; }
        .confidence-bar {
            height: 6px;
            background: #0f3460;
            border-radius: 3px;
            margin-top: 10px;
        }
        .confidence-fill {
            height: 100%;
            background: #00d4ff;
            border-radius: 3px;
            transition: width 0.5s;
        }
        .emotion-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .emotion-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .emotion-bar {
            flex: 1;
            height: 20px;
            background: #0f3460;
            border-radius: 4px;
            margin-left: 10px;
            overflow: hidden;
        }
        .emotion-fill {
            height: 100%;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            transition: width 0.5s;
        }
        .entity-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .entity-tag {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 13px;
        }
        .entity-PERSON { background: #e91e63; color: #fff; }
        .entity-ORGANIZATION { background: #2196f3; color: #fff; }
        .entity-LOCATION { background: #4caf50; color: #fff; }
        .entity-MISCELLANEOUS { background: #ff9800; color: #fff; }
        .events-log {
            background: #0f3460;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .event-line {
            padding: 4px 0;
            border-bottom: 1px solid #1a1a2e;
        }
        .event-line:last-child {
            border-bottom: none;
        }
        .event-type {
            color: #00d4ff;
            font-weight: bold;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† NLP Sentiment Dashboard</h1>

        <div class="input-section">
            <textarea id="textInput" placeholder="Enter text to analyze... (e.g., 'Apple reported record earnings today. CEO Tim Cook expressed optimism about future growth.')"></textarea>
            <div class="model-toggles">
                <label class="model-toggle">
                    <input type="checkbox" id="model-finance" checked>
                    <span>üí∞ Finance</span>
                </label>
                <label class="model-toggle">
                    <input type="checkbox" id="model-social" checked>
                    <span>üì± Social</span>
                </label>
                <label class="model-toggle">
                    <input type="checkbox" id="model-emotion" checked>
                    <span>üòä Emotion</span>
                </label>
                <label class="model-toggle">
                    <input type="checkbox" id="model-ner" checked>
                    <span>üè∑Ô∏è Entities</span>
                </label>
            </div>
            <div class="controls">
                <button class="btn-primary" id="analyzeBtn" onclick="startAnalysis()">
                    üöÄ Analyze (Streaming)
                </button>
                <button class="btn-secondary" onclick="clearResults()">
                    üóëÔ∏è Clear
                </button>
            </div>
        </div>

        <div class="progress-section" id="progressSection">
            <div class="status-text" id="statusText">Ready to analyze</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="results-grid">
            <!-- Finance Sentiment Card -->
            <div class="result-card" id="financeCard">
                <h3><span class="icon">üí∞</span> Financial Sentiment</h3>
                <div id="financeResult">
                    <p class="status-text">Waiting for analysis...</p>
                </div>
            </div>

            <!-- Social Sentiment Card -->
            <div class="result-card" id="socialCard">
                <h3><span class="icon">üì±</span> Social Sentiment</h3>
                <div id="socialResult">
                    <p class="status-text">Waiting for analysis...</p>
                </div>
            </div>

            <!-- Emotion Card -->
            <div class="result-card" id="emotionCard">
                <h3><span class="icon">üòä</span> Emotion Analysis</h3>
                <div id="emotionResult">
                    <p class="status-text">Waiting for analysis...</p>
                </div>
            </div>

            <!-- NER Card -->
            <div class="result-card" id="nerCard">
                <h3><span class="icon">üè∑Ô∏è</span> Named Entities</h3>
                <div id="nerResult">
                    <p class="status-text">Waiting for analysis...</p>
                </div>
            </div>
        </div>

        <div class="events-log" id="eventsLog">
            <div class="event-line"><span class="event-type">[INFO]</span> Dashboard ready. Enter text and click Analyze.</div>
        </div>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000';
        let eventSource = null;

        function getSelectedModels() {
            const models = [];
            if (document.getElementById('model-finance').checked) models.push('finance');
            if (document.getElementById('model-social').checked) models.push('social');
            if (document.getElementById('model-emotion').checked) models.push('emotion');
            if (document.getElementById('model-ner').checked) models.push('ner');
            return models;
        }

        function logEvent(type, message) {
            const log = document.getElementById('eventsLog');
            const line = document.createElement('div');
            line.className = 'event-line';
            line.innerHTML = `<span class="event-type">[${type}]</span> ${message}`;
            log.appendChild(line);
            log.scrollTop = log.scrollHeight;
        }

        function updateProgress(step, total, status) {
            const fill = document.getElementById('progressFill');
            const text = document.getElementById('statusText');
            fill.style.width = `${(step / total) * 100}%`;
            text.textContent = status;
        }

        function clearResults() {
            document.getElementById('financeResult').innerHTML = '<p class="status-text">Waiting for analysis...</p>';
            document.getElementById('socialResult').innerHTML = '<p class="status-text">Waiting for analysis...</p>';
            document.getElementById('emotionResult').innerHTML = '<p class="status-text">Waiting for analysis...</p>';
            document.getElementById('nerResult').innerHTML = '<p class="status-text">Waiting for analysis...</p>';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('statusText').textContent = 'Ready to analyze';
            ['financeCard', 'socialCard', 'emotionCard', 'nerCard'].forEach(id => {
                document.getElementById(id).classList.remove('complete', 'loading');
            });
        }

        function renderFinanceResult(result) {
            const ensemble = result.ensemble;
            const badgeClass = `sentiment-${ensemble.label}`;
            return `
                <span class="sentiment-badge ${badgeClass}">${ensemble.label}</span>
                <p style="margin-top: 10px;">Confidence: ${(ensemble.confidence * 100).toFixed(1)}%</p>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: ${ensemble.confidence * 100}%"></div>
                </div>
                <p style="margin-top: 10px; font-size: 12px; color: #888;">
                    Raw Score: ${ensemble.raw_score.toFixed(3)} (-1 to +1)
                </p>
            `;
        }

        function renderSocialResult(result) {
            const badgeClass = `sentiment-${result.label}`;
            return `
                <span class="sentiment-badge ${badgeClass}">${result.label}</span>
                <p style="margin-top: 10px;">Confidence: ${(result.confidence * 100).toFixed(1)}%</p>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: ${result.confidence * 100}%"></div>
                </div>
            `;
        }

        function renderEmotionResult(result) {
            const top5 = result.emotions.slice(0, 5);
            const items = top5.map(e => `
                <div class="emotion-item">
                    <span>${e.emotion}</span>
                    <div class="emotion-bar">
                        <div class="emotion-fill" style="width: ${e.score * 100}%"></div>
                    </div>
                    <span style="margin-left: 10px; min-width: 50px;">${(e.score * 100).toFixed(1)}%</span>
                </div>
            `).join('');
            return `
                <p style="margin-bottom: 10px;">Primary: <strong>${result.primary_emotion}</strong></p>
                <div class="emotion-list">${items}</div>
            `;
        }

        function renderNerResult(result) {
            if (result.entities.length === 0) {
                return '<p class="status-text">No entities found</p>';
            }
            const tags = result.entities.map(e =>
                `<span class="entity-tag entity-${e.entity_type}">${e.entity} (${e.entity_type})</span>`
            ).join('');
            return `
                <p style="margin-bottom: 10px;">Found ${result.entity_count} entities</p>
                <div class="entity-list">${tags}</div>
            `;
        }

        function startAnalysis() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                alert('Please enter some text to analyze');
                return;
            }

            const models = getSelectedModels();
            if (models.length === 0) {
                alert('Please select at least one model');
                return;
            }

            // Close existing connection
            if (eventSource) {
                eventSource.close();
            }

            // Reset UI
            clearResults();
            document.getElementById('analyzeBtn').disabled = true;
            models.forEach(m => {
                document.getElementById(`${m}Card`).classList.add('loading');
            });

            // Build URL with query params
            const params = new URLSearchParams({
                text: text,
                models: models.join(',')
            });

            logEvent('START', `Connecting to stream with models: ${models.join(', ')}`);

            // Create EventSource
            eventSource = new EventSource(`${API_URL}/stream/analyze?${params}`);

            eventSource.addEventListener('start', (e) => {
                const data = JSON.parse(e.data);
                logEvent('START', `Analysis started with ${data.total_steps} models`);
                updateProgress(0, data.total_steps, 'Starting analysis...');
            });

            eventSource.addEventListener('progress', (e) => {
                const data = JSON.parse(e.data);
                logEvent('PROGRESS', `Processing ${data.model}...`);
                updateProgress(data.step - 1, data.total_steps, data.status);
            });

            eventSource.addEventListener('model_complete', (e) => {
                const data = JSON.parse(e.data);
                logEvent('COMPLETE', `${data.model} finished`);
                updateProgress(data.step, data.total_steps, `${data.model} complete`);

                const card = document.getElementById(`${data.model}Card`);
                card.classList.remove('loading');
                card.classList.add('complete');

                // Render result based on type
                const resultDiv = document.getElementById(`${data.model}Result`);
                switch (data.result_type) {
                    case 'finance_sentiment':
                        resultDiv.innerHTML = renderFinanceResult(data.result);
                        break;
                    case 'social_sentiment':
                        resultDiv.innerHTML = renderSocialResult(data.result);
                        break;
                    case 'emotion':
                        resultDiv.innerHTML = renderEmotionResult(data.result);
                        break;
                    case 'ner':
                        resultDiv.innerHTML = renderNerResult(data.result);
                        break;
                }
            });

            eventSource.addEventListener('complete', (e) => {
                const data = JSON.parse(e.data);
                logEvent('DONE', 'All analysis complete!');
                updateProgress(100, 100, 'Analysis complete!');
                document.getElementById('analyzeBtn').disabled = false;
                eventSource.close();
            });

            eventSource.addEventListener('error', (e) => {
                if (e.data) {
                    const data = JSON.parse(e.data);
                    logEvent('ERROR', `${data.model}: ${data.error}`);
                }
            });

            eventSource.onerror = (e) => {
                logEvent('ERROR', 'Connection error - is the server running?');
                document.getElementById('analyzeBtn').disabled = false;
                eventSource.close();
            };
        }

        // Set default text
        document.getElementById('textInput').value =
            "Apple CEO Tim Cook announced record quarterly earnings in Cupertino today. " +
            "The company's stock soared 5% after the news. Investors are thrilled about the AI initiatives!";
    </script>
</body>
</html>
